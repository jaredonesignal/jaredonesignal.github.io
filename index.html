<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OneSignal Web Push with Notify Button</title>

  <!-- OneSignal Web SDK v16 -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: #0b1020;
      color: #e5e7eb;
    }
    .card {
      border: 1px solid #1f2937;
      border-radius: 16px;
      padding: 24px;
      max-width: 560px;
      width: 92%;
      background: #111827;
    }
    button {
      padding: 10px 14px;
      border-radius: 10px;
      border: 0;
      cursor: pointer;
      font-weight: 600;
      background: #3b82f6;
      color: white;
    }
    code {
      background: #0f172a;
      padding: 6px 10px;
      border-radius: 8px;
      color: #93c5fd;
    }
    pre {
      background: #0f172a;
      color: #d1d5db;
      padding: 12px;
      border-radius: 10px;
      overflow: auto;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>ðŸ”” OneSignal Web Push Receiver (Notify Button Enabled)</h2>
    <p>Click the Notify Button (bottom-right) to subscribe or manage your notifications.</p>

    <div style="margin-top:16px;">
      Subscription ID: <code id="subId">â€”</code>
    </div>

    <pre id="log"></pre>
  </div>

  <script>
    const APP_ID = "4bd637c1-11d5-46bf-b1c3-c203b648b25e"; // your App ID

    const $ = (id) => document.getElementById(id);
    const log = (m) => { $("log").textContent += `${new Date().toLocaleTimeString()} â€” ${m}\n`; };

    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      try {
        log("Initializing OneSignalâ€¦");
        await OneSignal.init({
          appId: APP_ID,
          allowLocalhostAsSecureOrigin: true,

          // Notify Button configuration (v16)
          notifyButton: {
            enable: true
          },

          // Optional: localize or customize pre-permission prompt
          promptOptions: {
            slidedown: {
              prompts: [{
                type: "push",
                autoPrompt: true,
                text: {
                  actionMessage: "Weâ€™d like to send you updates and product news.",
                  acceptButton: "Allow",
                  cancelButton: "No thanks"
                },
                delay: { pageViews: 1, timeDelay: 3 }
              }]
            }
          }
        });

        log("SDK initialized.");

        // Subscription state listener
        OneSignal.User.PushSubscription.addEventListener("change", (evt) => {
          const id = evt?.current?.id || "";
          $("subId").textContent = id || "â€”";
          log("PushSubscription change:\n" + JSON.stringify(evt, null, 2));
        });

        // Initial snapshot
        await refreshStatus(OneSignal);
      } catch (e) {
        log("Init error: " + (e.message || e));
      }
    });

    async function refreshStatus(OneSignal) {
      const permission = OneSignal.Notifications.permission;   // boolean
      const optedIn = OneSignal.User.PushSubscription.optedIn; // boolean
      let id = "";
      try { id = OneSignal.User.PushSubscription.id || ""; } catch {}
      $("subId").textContent = id || "â€”";
      log(JSON.stringify({ permission, optedIn, id }, null, 2));
    }
  </script>
</body>
</html>
